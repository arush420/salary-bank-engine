{% extends "base.html" %}
{% block title %}Employee Draft Approvals{% endblock %}

{% block content %}

<h2>üõ° Employee Draft Approvals</h2>

{% if draft_data %}
<div class="table-container mt-3">
    <table>
        <caption class="visually-hidden">Pending employee draft approvals with conflict information</caption>
        <thead>
            <tr>
                <th>Company</th>
                <th>Emp Code</th>
                <th>Name</th>
                <th>UAN</th>
                <th>ESIC</th>
                <th>Created By</th>
                <th>Conflicts</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
        {% for item in draft_data %}
            <tr>
                <td>{{ item.draft.company }}</td>
                <td>{{ item.draft.emp_code }}</td>
                <td>{{ item.draft.name }}</td>
                <td>{{ item.draft.uan_number|default:"‚Äî" }}</td>
                <td>{{ item.draft.esic_number|default:"‚Äî" }}</td>
                <td>{{ item.draft.created_by|default:"‚Äî" }}</td>

                <td>
                    {% if item.conflicts %}
                        <ul class="conflict-list">
                            {% for conflict in item.conflicts %}
                                <li>{{ conflict }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <span class="no-conflicts">‚úî No conflicts</span>
                    {% endif %}
                </td>

                <td>
                    {% if item.can_approve %}
                        <a class="btn btn-success btn-sm"
                           href="{% url 'employees:approve_employee_draft' item.draft.id %}"
                           aria-label="Approve draft for {{ item.draft.name }}">
                            Approve
                        </a>
                    {% else %}
                        <button class="btn btn-secondary btn-sm"
                                disabled
                                aria-label="Cannot approve draft for {{ item.draft.name }}">
                            Cannot Approve
                        </button>
                    {% endif %}

                    {% if item.merge_candidate %}
                        <a class="btn btn-warning btn-sm"
                           href="{% url 'employees:merge_employee_draft' item.draft.id %}"
                           aria-label="Merge draft for {{ item.draft.name }}">
                            üîÅ Merge
                        </a>
                    {% endif %}

                    <a class="btn btn-danger btn-sm"
                       href="{% url 'employees:reject_employee_draft' item.draft.id %}"
                       aria-label="Reject draft for {{ item.draft.name }}">
                        Reject
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
    <p class="mt-3">No pending drafts üéâ</p>
{% endif %}

{% endblock %}


.conflict-list {
    color: #dc3545;
    margin: 0;
    padding-left: 18px;
}

.no-conflicts {
    color: #28a745;
}

.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}