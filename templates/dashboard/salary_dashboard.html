{% extends "base.html" %}
{% block content %}

<form method="get" style="margin-bottom: 20px;">
    <label>
        Month:
        <select name="month">
            {% for m in months %}
                <option value="{{ m }}" {% if m == month %}selected{% endif %}>
                    {{ m }}
                </option>
            {% endfor %}
        </select>
    </label>

    <label style="margin-left: 10px;">
        Year:
        <select name="year">
            {% for y in years %}
                <option value="{{ y }}" {% if y == year %}selected{% endif %}>
                    {{ y }}
                </option>
            {% endfor %}
        </select>
    </label>

    <button type="submit">Apply</button>
</form>

{% if stats %}

<div style="display: flex; gap: 20px; margin-top: 20px;">

    <div>
        <strong>Pending</strong><br>
        <a href="{% url 'dashboard:salary_status_list' 'PENDING' %}?month={{ month }}&year={{ year }}">
            {{ stats.pending }}
        </a>
    </div>

    <div>
        <strong>Hold</strong><br>
        <a href="{% url 'dashboard:salary_status_list' 'HOLD' %}?month={{ month }}&year={{ year }}">
            {{ stats.hold }}
        </a>
    </div>

    <div>
        <strong>Processed</strong><br>
        <a href="{% url 'dashboard:salary_status_list' 'PROCESSED' %}?month={{ month }}&year={{ year }}">
            {{ stats.processed }}
        </a>
    </div>

    <div>
        <strong>Failed</strong><br>
        <a href="{% url 'dashboard:salary_status_list' 'FAILED' %}?month={{ month }}&year={{ year }}">
            {{ stats.failed }}
        </a>
    </div>

</div>

{% if batch %}

    {% if batch.status == "EXPORTED" %}
        <div class="alert alert-warning">
            ğŸ”’ Salary batch locked (Exported to bank)
        </div>

    {% elif batch.status == "REVERSED" %}
        <div class="alert alert-danger">
            âŒ This batch was reversed by admin. All actions are locked.
        </div>

    {% endif %}

    {% if batch.status != "REVERSED" and stats.failed > 0 %}
        <a href="{% url 'banking:retry_failed' batch.id %}">
            ğŸ” Retry Failed Transactions
        </a>
    {% endif %}

{% endif %}


{% else %}
    <p>No salary data found for selected month/year.</p>
{% endif %}

{% endblock %}
